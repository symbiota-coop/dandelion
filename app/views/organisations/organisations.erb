<% if !current_account %>
  <h1>Organisations</h1>
<% end %>
<a class="btn btn-primary mt-1 mt-lg-0 mb-3" href="/o/new"><i class="bi bi-plus-lg"></i> Create an organisation</a>

<% form_tag '/organisations', method: 'get', class: 'submitOnChange searchForm form-inline mb-3' do %>
  <%= hidden_field_tag :display, value: params[:display] %>
  <%= hidden_field_tag :order, value: params[:order] %>
  <div class="form-group">
    <label>Search</label>
    <%= text_field_tag :q, class: 'form-control', value: params[:q] %>
  </div>
  <% if current_account %>
    <%= checkbox 'Following' %>
  <% end %>
  <%= submit_tag 'Search', class: 'btn btn-primary' %>
  <%= hidden_field_tag :search, value: 1 %>
<% end %>

<%
  view_options = [
    { key: 'blocks', label: 'Blocks', icon: 'bi-grid-fill', active: !params[:display] || params[:display] == 'blocks' },
    { key: 'network', label: 'Network', icon: 'bi-share', active: params[:display] == 'network' },
    { key: 'map', label: 'Map', icon: 'bi-geo-alt-fill', active: params[:display] == 'map' }
  ]
%>
<div class="row justify-content-between mb-3 mb-lg-0">

  <div class="col-12 col-sm">

    <ul class="pl-0 mb-3 d-flex align-items-center">
      <li class="list-inline-item">
        <label class="mb-0">View as</label>
      </li>
      <% view_options.each do |opt| %>
        <li class="list-inline-item">
          <a class="btn <%= 'btn-outline-primary' if opt[:active] %>" href="<%= view_url(opt[:key], path: (path if defined?(path))) %>">
            <i class="bi <%= opt[:icon] %>"></i> <%= opt[:label] %>
          </a>
        </li>
      <% end %>
    </ul>
  </div>

  <% if !params[:display] || params[:display] == 'blocks' %>
    <div class="col-12 col-lg-auto">
      <% form_tag (path if defined?(path)).to_s, method: 'get', class: 'form-inline submitOnChange' do %>
        <% view_base_params.reject { |k, _| %w[search order slug].include?(k) }.each do |k, v| %>
          <%= hidden_field_tag k, value: v %>
        <% end %>
        <%= hidden_field_tag :search, value: 1 %>
        <label class="mr-sm-2">Sort by</label>
        <%= select_tag :order, options: { 'Most followers' => 'followers_count', 'Most recently created' => 'created_at' }, selected: params[:order], class: 'form-control' %>
      <% end %>
    </div>
  <% end %>

</div>

<% if params[:display] == 'map' %>
  <%= partial :'maps/map', locals: { url: "/organisations", fill_screen: true } %>
<% elsif params[:display] == 'network' %>
  <p>
    Node size ~ number of followers, edge weight ~ number of mutual followers.
  </p>
  <%= partial :'organisations/network', locals: { organisations: @organisations } %>
<% else %>
  <%= partial :'organisations/blocks', locals: { organisations: @organisations } %>
  <%= will_paginate @organisations, param_name: 'organisations_page', page_links: false, renderer: WillPaginate::ViewHelpers::BootstrapRenderer %>
<% end %>
