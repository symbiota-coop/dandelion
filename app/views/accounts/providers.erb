<%= partial :'accounts/nav' %>

<div class="container">

  <table class="table table-borderless">
    <% Provider.all.each { |provider| %>
    <tr>
      <td style="width: 1px">
        <%= provider.display_name %>
      </td>
      <td>
        <% if (provider_link = @account.provider_links.select { |provider_link| provider_link.provider == provider.display_name }[0]) %>
          <% if (nickname = provider.nickname.call(provider_link.omniauth_hash)) %>
            <% if (profile_url = provider.profile_url.call(provider_link.omniauth_hash)) %>
              <a target="_blank" href="<%= profile_url %>"><%= nickname %></a>
            <% else %>
              <%= nickname %>
            <% end %>
            <br>
          <% end %>
          <% if current_account %>
            <a class="btn btn-outline-secondary mb-1" href="/accounts/disconnect/<%= provider.omniauth_name %>">Disconnect</a>
          <% end %>
        <% else %>
          <% if provider.omniauth_name == 'atproto' %>
            <a class="btn btn-primary mb-1" href="javascript:;" onclick="$('#atproto-connect-form').show().find('input[type=text]').focus();$(this).hide()"><i class="<%= provider.icon %>"></i> Connect</a>
            <%= partial :'accounts/atproto_form', locals: { id: 'atproto-connect-form', form_class: 'd-flex', button_text: 'Connect' } %>
          <% else %>
            <a class="btn btn-primary mb-1" href="/auth/<%= provider.omniauth_name %>"><i class="<%= provider.icon %>"></i> Connect</a>
          <% end %>
        <% end %>
      </td>
    </tr>
    <% } %>
  </table>

</div>