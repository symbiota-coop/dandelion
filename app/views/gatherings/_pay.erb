<% form_tag '', class: 'form-inline no-trigger', id: 'pay-form' do %>
  <div class="form-group mb-1 mr-1">
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><%= money_symbol(@gathering.currency) %></span>
      </div>
      <% if @gathering.enable_partial_payments %>
        <%= number_field_tag :amount, value: (amount if defined?(amount)), style: 'width: 5em;', required: 'required', class: 'form-control', id: 'amount' %>
      <% else %>
        <%= number_field_tag :amount, value: (amount if defined?(amount)), style: 'width: 5em;', disabled: true, class: 'form-control' %>
        <%= hidden_field_tag :amount, value: (amount if defined?(amount)), id: 'amount' %>
      <% end %>
    </div>
  </div>
  <% if @gathering.stripe_sk && FIAT_CURRENCIES.include?(@gathering.currency) %>
    <button data-payment-method="stripe" type="submit" class="btn btn-default mb-1 ml-0 mr-1" style="height: 2.125rem">
      Pay with card
      <i class="bi bi-spin bi-slash-lg" style="display: none"></i>
    </button>
    <%= hidden_field_tag :payment_method, value: 'stripe', disabled: true %>
  <% end %>
  <% if @gathering.coinbase_api_key && (FIAT_CURRENCIES.include?(@gathering.currency) || COINBASE_CURRENCIES.include?(@gathering.currency)) %>
    <button data-payment-method="coinbase" type="submit" class="btn btn-default mb-1 ml-0 mr-1" style="height: 2.125rem">
      Pay with crypto
      <i class="bi bi-spin bi-slash-lg" style="display: none"></i>
    </button>
    <%= hidden_field_tag :payment_method, value: 'coinbase', disabled: true %>
  <% end %>
  <% if @gathering.evm_address && EVM_CURRENCIES.include?(@gathering.currency) %>
    <button data-payment-method="evm" type="submit" class="btn btn-default mb-1 ml-0 mr-1" style="height: 2.125rem">
      <span>
        Pay with <%= @gathering.chain.name %>
      </span>
      <i class="bi bi-spin bi-slash-lg" style="display: none"></i>
    </button>
    <%= hidden_field_tag :payment_method, value: 'evm', disabled: true %>
  <% end %>


<% end %>

<%
  pay_config = {
    gatheringSlug: @gathering.slug,
    currency: @gathering.currency,
    currencySymbol: money_symbol(@gathering.currency),
    stripePk: @gathering.stripe_pk,
    evmAddress: @gathering.evm_address,
    contractAddress: (@gathering.currency == 'USD' ? Token.object('BREAD').contract_address : @gathering.token.try(:contract_address)),
    networkId: @gathering.chain.try(:network_id),
    networkName: @gathering.chain.try(:name)
  }
%>
<script type="application/json" id="gathering-pay-config">
  <%== pay_config.to_json %>
</script>
<% if @gathering.evm_address && @gathering.chain %>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.4/web3.min.js"></script>
<% end %>
<script src="/javascripts/gathering_pay.js?<%= @cachebuster %>"></script>
