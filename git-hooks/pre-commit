#!/bin/bash

# Configuration
GEMFILE_PATH="Gemfile"
FRONTEND_DEPENDENCIES_PATH="app/views/layouts/_dependencies.erb"
OUTPUT_PATH="AGENTS.md"

# Function to add a dependency section to the output file
add_dependency_section() {
  local title="$1"
  local file_path="$2"
  
  {
    echo ""
    echo "## $title"
    echo ""
    echo "\`\`\`"
    cat "$file_path"
    echo "\`\`\`"
  } >> "$OUTPUT_PATH"
}

# Create the output file with initial instructions
cat > "$OUTPUT_PATH" << 'EOF'
# MongoDB indexes

Please note that MongoDB indexes are created directly in the database, and are not exhaustively defined in model files.

# Tests

Use the following command structure to test a single file:

`foreman run -e .env.test bundle exec ruby -I test test/$1_test.rb`

# Dependencies
EOF

# Add content
add_dependency_section "Gemfile" "$GEMFILE_PATH"
add_dependency_section "Frontend dependencies" "$FRONTEND_DEPENDENCIES_PATH"
